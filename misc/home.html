<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Yelp Visualizer</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />  
  <script src="https://code.jquery.com/jquery-1.11.2.min.js" type ="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/js/bootstrap.min.js" type ="text/javascript"></script>
  <script src="localStorage.js"></script>
  <style>a{cursor:pointer;}</style>
</head>
<body>
<div class="container">
<div class="navbar">
  <div class="navbar-inner">
    <a class="brand" href="#"><i class="fa fa-map-marker"></i> Yelp Visualizer</a>
    <ul class="nav">
      <li class="active"><a href="#"><i class="fa fa-globe"></i> Map</a></li>
      <li><a href="#"><i class="fa fa-info-circle"></i> About</a></li>
      <li><a href="#">Link</a></li>
    </ul>
  </div>
</div>
<style>
  #map {width:100%; height:500px; margin-bottom:40px; background-color:grey;}
  #left-nav{height:500px; max-height:500px; overflow-y:scroll;}
  select,input{width:90%}
  .well{width:80%;}
  .hidden{display:none;}
</style>
<div class="row">

<!-- BEGIN EDITABLE -->

<div id="left-nav" class="span3">
  <h2>Filters</h2>

  <label>City</label>
  <select id="input-city">
    <option value="Charlotte">Charlotte</option>
    <option value="Las Vegas">Las Vegas</option>
    <option value="Madison">Madison</option>
    <option value="Montreal">Montreal</option>
    <option value="Phoenix">Phoenix</option>
    <option value="Pittsburgh">Pittsburgh</option>
  </select>

  <br><br>

  <div class="text-center">
    <button id="search-btn" class="btn btn-primary"><i class="fa fa-search"></i> Search</button>
  </div>

  <br>

  <p><a onclick="useCurrentLocation()"><i class="fa fa-map-marker"></i> Current Location</a></p>

  <p><a onclick="toggleHidden('save')"><i class="fa fa-save"></i> Save Search</a></p>

  <div id="save-well" class="well well-small hidden">
    <label>What would you like to name your search?</label>
    <input id="input-save" type="text" placeholder="Untitled"></input>
    <div class="text-center">
      <button id="save-btn" class="btn text-center" onclick="saveSearch()">Save</button>
    </div>
  </div>

  <p><a onclick="toggleHidden('upload')"><i class="fa fa-upload"></i> Load Search</a></p>

  <div id="upload-well" class="well well-small hidden">
    <label>Which search would you like to load?</label>
    <select id="input-upload"></select>
    <div class="text-center">
      <button id="load-btn" class="btn text-center" onclick="loadSearch()">Load</button>
    </div>
  </div>

  <p><a onclick="toggleHidden('history')"><i class="fa fa-history"></i> Recent Searches</a></p>
  <div id="history-well" class="well well-small hidden"></div>

</div>

<script>

var toggleHidden = function (str) {
  $('#' + str + '-well').toggleClass('hidden');
};

var loadAllSearches = function () {
  var keys = db.load('keys');
  $('#input-upload').empty();
  $.each(keys, function (key, value) {   
    $('#input-upload').append($('<option>', {'value': value}).text(value)); 
  });
};

var getFormData = function () {
  var formData = {};
  formData.city = $('#input-city').val();
  //formData.categories = $('#input-category').val() || [];
  //formData.attributes = $('#input-attr').val() || [];
  return formData;
};

var setFormData = function (data) {
  $('#input-city').val(data.city);
};

var saveSearch = function () {
  var name = $('#input-save').val() || 'Untitled';
  db.save(name, getFormData());
  loadAllSearches();
};

var loadSearch = function () {
  var name = $('#input-upload').val();
  if (! name) return;
  var data = db.load(name);
  setFormData(data);
};

var recentSearches = [];

var searchRecent = function (n) {
  setFormData(recentSearches[n].data);
};

var updateHistory = function () {
  recentSearches.unshift({'timestamp': new Date().toLocaleString(), 'data': getFormData()});
  $('#history-well').empty();
  for (var i = 0; i < 10; i++) {
    if (! recentSearches[i]) return;
    $('#history-well').append('<p><a onclick="searchRecent(' + i + ')">' + recentSearches[i].timestamp + '</a></p>');
  }
};

$('#search-btn').click(function() {
  updateHistory();
});

db.init();
loadAllSearches();

</script>

<!-- END EDITABLE -->

<div class="span9">
<div id="map"></div>
</div>

</div> <!-- /.row -->
</div> <!-- /.container -->
</body>
</html>

